<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Vendas Fiadas - Controle de CrÃ©dito</title>
    <link rel="stylesheet" href="style.css?v=1.3.0">
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">ğŸ“‹</div>
                <h1>Vendas Fiadas</h1>
                <p>Controle de vendas a crÃ©dito</p>
            </div>

            <div id="emailTab" class="tab-content active">
                <form id="loginForm">
                    <input type="email" id="loginEmail" placeholder="Email" required>
                    <input type="password" id="loginPassword" placeholder="Senha" required>
                    <button type="submit" class="btn btn-primary">Entrar</button>
                </form>
                <p class="login-toggle">NÃ£o tem conta? <a href="#" id="showRegister">Cadastre-se grÃ¡tis</a></p>
            </div>

            <div id="registerForm" class="tab-content" style="display: none;">
                <form id="signupForm">
                    <input type="email" id="signupEmail" placeholder="Email" required>
                    <input type="password" id="signupPassword" placeholder="Senha (mÃ­n. 8 caracteres, 1 maiÃºscula, 1 nÃºmero)" required minlength="8">
                    <input type="password" id="signupPasswordConfirm" placeholder="Confirme a senha" required minlength="8">
                    <button type="submit" class="btn btn-primary">Criar Conta</button>
                </form>
                <p class="login-toggle">JÃ¡ tem conta? <a href="#" id="showLogin">FaÃ§a login</a></p>
            </div>
        </div>
    </div>

    <!-- App Principal -->
    <div id="appScreen" class="container" style="display: none;">
        <header>
            <div class="header-content">
                <div>
                    <h1>ğŸ“‹ Vendas Fiadas</h1>
                    <p class="subtitle">Controle de vendas a crÃ©dito</p>
                </div>
                <div class="user-info">
                    <span id="userEmail" class="user-email"></span>
                    <button id="logoutBtn" class="btn btn-logout">Sair</button>
                </div>
            </div>
        </header>

        <main>
            <!-- FormulÃ¡rio para venda - cliente existente -->
            <section class="card">
                <h2>Venda para Cliente Cadastrado</h2>
                <form id="addSaleExistingForm">
                    <select id="selectExistingClient" required>
                        <option value="">Selecione o cliente</option>
                    </select>
                    <input type="number" id="saleAmountExisting" placeholder="Valor (R$)" step="0.01" min="0.01" required>
                    <input type="text" id="saleDescriptionExisting" placeholder="DescriÃ§Ã£o (opcional)">
                    <button type="submit" class="btn btn-primary">+ Registrar Venda</button>
                </form>
            </section>

            <!-- FormulÃ¡rio para novo cliente + venda -->
            <section class="card">
                <h2>Novo Cliente + Primeira Venda</h2>
                <form id="addSaleForm">
                    <input 
                        type="text" 
                        id="clientNameInput" 
                        placeholder="Nome do novo cliente" 
                        autocomplete="off"
                        required>
                    <input type="number" id="saleAmount" placeholder="Valor (R$)" step="0.01" min="0.01" required>
                    <input type="text" id="saleDescription" placeholder="DescriÃ§Ã£o (opcional)">
                    <button type="submit" class="btn btn-success">+ Cadastrar e Registrar Venda</button>
                </form>
            </section>

            <!-- Cards de Totais -->
            <div class="totals-container">
                <div class="total-card debt-card">
                    <div class="total-label">Total a Receber</div>
                    <div class="total-value">R$ <span id="totalDebt">0,00</span></div>
                </div>
                <div class="total-card credit-card" id="creditCard" style="display: none;">
                    <div class="total-label">CrÃ©dito dos Clientes</div>
                    <div class="total-value">R$ <span id="totalCredit">0,00</span></div>
                </div>
            </div>

            <!-- Lista de clientes com dÃ©bitos -->
            <section class="card">
                <div class="section-header">
                    <h2>Clientes com DÃ©bitos</h2>
                </div>
                <div id="clientsListDiv" class="clients-list">
                    <p class="empty-message">Nenhum cliente cadastrado ainda.</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal para detalhes do cliente -->
        <div id="clientModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                
                <!-- Nome do cliente com ediÃ§Ã£o inline -->
                <div class="client-name-section">
                    <h2 id="modalClientName" class="editable-name"></h2>
                    <button id="editNameBtn" class="btn-edit-name" title="Editar nome">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                    </button>
                </div>
                
                <!-- FormulÃ¡rio de ediÃ§Ã£o (oculto por padrÃ£o) -->
                <form id="editNameForm" class="edit-name-form" style="display: none;">
                    <input type="text" id="editClientName" placeholder="Nome do cliente" required>
                    <div class="edit-name-actions">
                        <button type="submit" class="btn btn-primary btn-sm">âœ“ Salvar</button>
                        <button type="button" id="cancelEditName" class="btn btn-secondary btn-sm">âœ• Cancelar</button>
                    </div>
                </form>
                
                <div class="modal-debt">
                    DÃ©bito total: <strong>R$ <span id="modalDebt">0,00</span></strong>
                </div>

                <h3>Adicionar Nova Venda</h3>
                <form id="modalAddSaleForm">
                    <input type="number" id="modalSaleAmount" placeholder="Valor da venda (R$)" step="0.01" min="0.01" required>
                    <input type="text" id="modalSaleDescription" placeholder="DescriÃ§Ã£o (opcional)">
                    <button type="submit" class="btn btn-primary">ğŸ’µ Adicionar Venda</button>
                </form>

                <h3>Registrar Pagamento</h3>
                <form id="paymentForm">
                    <input type="number" id="paymentAmount" placeholder="Valor do pagamento (R$)" step="0.01" min="0.01" required>
                    <button type="submit" class="btn btn-success">âœ“ Registrar Pagamento</button>
                </form>

                <h3>HistÃ³rico de Vendas</h3>
                <div id="salesHistory" class="sales-history"></div>

                <div class="modal-actions">
                    <button id="clearHistory" class="btn btn-warning">ğŸ§¹ Limpar HistÃ³rico</button>
                    <button id="deleteClient" class="btn btn-danger">ğŸ—‘ï¸ Excluir Cliente</button>
                </div>
            </div>
        </div>

    <!-- Loader -->
    <div id="loader" class="loader-overlay">
        <div class="loader-spinner"></div>
        <p class="loader-text">Salvando...</p>
    </div>

    <!-- Toast de Sucesso -->
    <div id="toast" class="toast">
        <span class="toast-icon">âœ“</span>
        <span class="toast-message">Salvo com sucesso!</span>
    </div>

    <!-- Modal de ConfirmaÃ§Ã£o -->
    <div id="confirmModal" class="confirm-modal">
        <div class="confirm-modal-content">
            <div class="confirm-modal-icon">âš ï¸</div>
            <h3 id="confirmTitle">Confirmar AÃ§Ã£o</h3>
            <p id="confirmMessage">Tem certeza que deseja continuar?</p>
            <div class="confirm-modal-actions">
                <button id="confirmCancel" class="btn btn-secondary">Cancelar</button>
                <button id="confirmOk" class="btn btn-danger">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="app.js?v=1.3.0"></script>
</body>
</html>
