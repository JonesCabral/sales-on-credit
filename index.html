<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Fiado F√°cil</title>
    <link rel="stylesheet" href="style.css?v=1.6.0">
</head>
<body class="loading">
    <!-- Tela de Login -->
    <div id="loginScreen" class="login-screen" style="display: none;">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">üìã</div>
                <h1>Fiado F√°cil</h1>
                <p>Controle de vendas a cr√©dito</p>
            </div>

            <div id="emailTab" class="tab-content active">
                <form id="loginForm">
                    <input type="email" id="loginEmail" placeholder="Email" required>
                    <input type="password" id="loginPassword" placeholder="Senha" required>
                    <button type="submit" class="btn btn-primary">Entrar</button>
                </form>
            </div>
        </div>
    </div>

    <!-- App Principal -->
    <div id="appScreen" class="container" style="display: none;">
        <header>
            <div class="header-content">
                <div>
                    <h1>üìã Fiado F√°cil</h1>
                    <p class="subtitle">Controle de vendas a cr√©dito</p>
                </div>
                <div class="user-info">
                    <span id="userEmail" class="user-email"></span>
                    <button id="logoutBtn" class="btn btn-logout">Sair</button>
                </div>
            </div>
        </header>

        <main>
            <!-- Formul√°rio para registrar venda -->
            <section class="card">
                <h2>Registrar Venda Fiada</h2>
                <form id="addSaleForm">
                    <div class="autocomplete-wrapper">
                        <input 
                            type="text" 
                            id="clientSearch" 
                            placeholder="Digite o nome do cliente ou adicione novo"
                            autocomplete="off"
                            required>
                        <div id="clientSuggestions" class="suggestions-dropdown"></div>
                    </div>
                    <input type="number" id="saleAmount" placeholder="Valor (R$)" step="0.01" min="0.01" required>
                    <input type="text" id="saleDescription" placeholder="Descri√ß√£o (opcional)">
                    <button type="submit" class="btn btn-primary">+ Registrar Venda</button>
                </form>
            </section>

            <!-- Cards de Totais -->
            <div class="totals-container">
                <div class="total-card debt-card">
                    <div class="total-label">Total a Receber</div>
                    <div class="total-value">R$ <span id="totalDebt">0,00</span></div>
                </div>
                <div class="total-card credit-card" id="creditCard" style="display: none;">
                    <div class="total-label">Cr√©dito dos Clientes</div>
                    <div class="total-value">R$ <span id="totalCredit">0,00</span></div>
                </div>
            </div>

            <!-- Lista de clientes com d√©bitos -->
            <section class="card">
                <div class="section-header">
                    <h2>Adicionar Pagamento</h2>
                </div>
                <div class="filter-search-container">
                    <input 
                        type="text" 
                        id="searchClients" 
                        placeholder="üîç Buscar cliente por nome..."
                        autocomplete="off"
                        class="search-input">
                    <div class="filter-checkbox-container">
                        <label class="filter-checkbox-label">
                            <input type="checkbox" id="filterDebtOnly" checked>
                            <span>Apenas com d√≠vidas</span>
                        </label>
                    </div>
                </div>
                <div id="clientsListDiv" class="clients-list">
                    <p class="empty-message">Nenhum cliente cadastrado ainda.</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal para detalhes do cliente -->
        <div id="clientModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                
                <!-- Nome do cliente com edi√ß√£o inline -->
                <div class="client-name-section">
                    <h2 id="modalClientName" class="editable-name"></h2>
                    <button id="editNameBtn" class="btn-edit-name" title="Editar nome">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Formul√°rio de edi√ß√£o (oculto por padr√£o) -->
                <form id="editNameForm" class="edit-name-form" style="display: none;">
                    <input type="text" id="editClientName" placeholder="Nome do cliente" required>
                    <div class="edit-name-actions">
                        <button type="submit" class="btn btn-primary btn-sm">‚úì Salvar</button>
                        <button type="button" id="cancelEditName" class="btn btn-secondary btn-sm">‚úï Cancelar</button>
                    </div>
                </form>
                
                <div class="modal-debt">
                    D√©bito total: <strong>R$ <span id="modalDebt">0,00</span></strong>
                </div>

                <h3>Registrar Pagamento</h3>
                <form id="paymentForm">
                    <input type="number" id="paymentAmount" placeholder="Valor do pagamento (R$)" step="0.01" min="0.01" required>
                    <button type="submit" class="btn btn-success">‚úì Registrar Pagamento</button>
                </form>

                <h3>Adicionar Nova Venda</h3>
                <form id="modalAddSaleForm">
                    <input type="number" id="modalSaleAmount" placeholder="Valor da venda (R$)" step="0.01" min="0.01" required>
                    <input type="text" id="modalSaleDescription" placeholder="Descri√ß√£o (opcional)">
                    <button type="submit" class="btn btn-primary">üíµ Adicionar Venda</button>
                </form>

                <div class="history-header">
                    <h3>Hist√≥rico de Vendas</h3>
                    <button id="shareHistory" class="btn btn-share" title="Compartilhar hist√≥rico">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="18" cy="5" r="3"/>
                            <circle cx="6" cy="12" r="3"/>
                            <circle cx="18" cy="19" r="3"/>
                            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                        </svg>
                        Compartilhar
                    </button>
                </div>
                <div id="salesHistory" class="sales-history"></div>

                <div class="modal-actions">
                    <button id="clearHistory" class="btn btn-warning">üßπ Limpar Hist√≥rico</button>
                    <button id="deleteClient" class="btn btn-danger">üóëÔ∏è Excluir Cliente</button>
                </div>
            </div>
        </div>

    <!-- Loader -->
    <div id="loader" class="loader-overlay">
        <div class="loader-spinner"></div>
        <p class="loader-text">Salvando...</p>
    </div>

    <!-- Toast de Sucesso -->
    <div id="toast" class="toast">
        <span class="toast-icon">‚úì</span>
        <span class="toast-message">Salvo com sucesso!</span>
    </div>

    <!-- Modal de Confirma√ß√£o -->
    <div id="confirmModal" class="confirm-modal">
        <div class="confirm-modal-content">
            <div class="confirm-modal-icon">‚ö†Ô∏è</div>
            <h3 id="confirmTitle">Confirmar A√ß√£o</h3>
            <p id="confirmMessage">Tem certeza que deseja continuar?</p>
            <div class="confirm-modal-actions">
                <button id="confirmCancel" class="btn btn-secondary">Cancelar</button>
                <button id="confirmOk" class="btn btn-danger">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="app.js?v=1.6.0"></script>
</body>
</html>
